# Usage

## Get migration data

This script will get the token manager data from the NodeManagementV3 contract and save it to a JSON file.

With the environment variable `END_TOKEN_ID` you can set the end tokenId to get the data for. If not set, it will get the data for all tokens. The purpose mainly allowing faster testing

```bash

# Partial tokens
END_TOKEN_ID=1000 yarn contracts:token-manager:get-migration-data:solo # update the network name to the desired network

# All tokens
yarn contracts:token-manager:get-migration-data:solo # update the network name to the desired network
```

## Migrate nodes from JSON

With the environment variable `EXECUTE_TRANSACTIONS` you can set to execute the transactions to migrate the nodes. If not set, it will only print the transactions to be executed.

This script will read the JSON file generated by the `get-migration-data` script and migrate the nodes to the StargateNFT contract.

Will generate a JSON file with the results of the migration and the following file structure:

```
results/
  migration-results-{network}.json
  migration-dryrun-{network}.json
```

The results will be in the `results` folder.

If the `EXECUTE_TRANSACTIONS` environment variable is set to `true`, the transactions will be executed and the results will be saved as `migration-results-{network}.json` in the `results` folder.

If the `EXECUTE_TRANSACTIONS` environment variable is not set, the transactions will not be executed and the results will be saved as `migration-dryrun-{network}.json` in the `results` folder.

With the environment variable `BATCH_SIZE` you can set the batch size to migrate the nodes in multiclauses. If not set, it will default to 30.

```bash
# Dry run
yarn contracts:token-manager:migrate:solo # update the network name to the desired network

# Execute transactions
BATCH_SIZE=10 EXECUTE_TRANSACTIONS=true yarn contracts:token-manager:migrate:solo
```
